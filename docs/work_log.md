# WealthLite 项目工作日志

## 2025-06-14

### 项目初始化
- 创建项目目录结构
- 建立文档体系（docs/DEVELOPMENT_PLAN.md、docs/index.md、README.md）
- 完成详细需求分析与开发计划制定

### 需求分析完成
- 基于用户详细需求，重写开发计划文档
- 明确资产分类管理的预定义体系（5大类别，具体二级分类）
- 确定技术选型：Python 3.12 + Tkinter + CSV/JSON + XlsxWriter
- 制定4个开发阶段的详细目标和检查清单

### 文档结构建立
- docs/DEVELOPMENT_PLAN.md：完整开发计划（包含需求、技术选型、代码示例、测试策略等）
- docs/index.md：文档索引
- docs/design/：详细设计文档目录（待补充）
- docs/api/：API文档目录（待补充）
- docs/guides/：用户指南目录（待补充）
- README.md：项目概览

### 环境配置完成
- requirements.txt：核心依赖配置（xlsxwriter、cryptography等）
- environment.yml：Conda环境配置文件
- 项目结构规划：src/、tests/、data/等目录结构设计

### 技术选型最终确定
- **前端框架**：确定使用Tkinter（零依赖，内置GUI库）
- **数据存储**：CSV文件为主，JSON文件为辅
- **Excel导出**：XlsxWriter轻量级方案
- **打包工具**：PyInstaller生成绿色版EXE

### 下一步计划
- 开始第一阶段开发：数据模型设计和核心功能实现
- 创建src目录结构
- 实现Asset和Category数据模型
- 实现年化回报率计算引擎
- 建立基础的CSV数据存储功能

---

## 2025-01-14(续)

### 工作时间
- 总工作时长：约 6 小时

### 完成工作
1. **固定收益类产品币种汇率功能开发**
   - 扩展Asset和FixedIncomeProduct模型，支持四种币种（CNY、HKD、USD、AUD）
   - 实现汇率管理器和币种转换功能
   - 创建专门的固定收益类产品表单（FixedIncomeForm）

2. **资产表单架构重构**
   - 实现资产表单工厂模式（AssetFormFactory）
   - 创建资产类型选择器（AssetTypeSelector）
   - 统一新建和编辑流程，确保使用相同的专门表单

3. **UI界面问题修复**
   - 修复对话框按钮显示问题（调整尺寸从400x300到450x500）
   - 实现滚动表单布局，支持复杂表单内容展示
   - 修复导入错误和布局问题

4. **数据保存功能修复**
   - 添加详细调试日志，便于问题排查
   - 修复AssetManager.add_asset方法的分类验证问题
   - 确保数据正确保存到CSV文件

5. **年化回报率计算修复**
   - 修复FixedIncomeProduct.calculate_annualized_yield方法
   - 对于固定收益类产品，年化收益率直接等于年利率
   - 验证计算结果：3%年利率正确显示为3.00%

### Lessons Learned
1. **对话框布局验证**：创建Tkinter对话框时必须验证按钮是否在合适位置显示，避免内容过多导致按钮被挤出可视区域
2. **调试日志的重要性**：在复杂的保存流程中，详细的调试日志能快速定位问题，特别是数据流转过程
3. **业务逻辑简化**：对于固定收益类产品，年化收益率应该直接等于年利率，不需要复杂的数学计算

### 下一步计划
1. **功能完善**：继续完善其他资产类型的专门表单（股票类、基金类等）
2. **数据验证**：加强表单数据验证和错误处理机制
3. **用户体验优化**：改进界面响应速度和操作流畅性
4. **测试覆盖**：编写更全面的单元测试和集成测试

---

## 2025-01-14(续2) - 数据安全与目录结构重构

### 工作时间
- 工作时长：约 1.5 小时

### 完成工作
1. **数据安全架构设计**
   - 创建独立的`user_data/`目录存储所有敏感用户数据
   - 创建`config/`目录存储应用配置和用户设置
   - 实现配置与数据的完全分离，确保数据不会意外上传到GitHub

2. **配置管理系统**
   - 创建`ConfigManager`类统一管理应用配置和用户设置
   - 实现`config/app_config.json`：应用级配置（版本、默认分类、显示设置等）
   - 实现`config/user_settings.json`：用户偏好设置（窗口状态、主题、导出设置等）
   - 支持嵌套配置键设置和自动保存功能

3. **数据迁移功能**
   - 在`AssetManager`中实现自动数据迁移功能
   - 检测旧版本`data/`目录中的数据文件并自动迁移到`user_data/`
   - 迁移assets.csv、transactions.csv和备份文件
   - 保留旧文件以确保数据安全

4. **主窗口配置集成**
   - 修改`MainWindow`使用`ConfigManager`获取数据目录和窗口设置
   - 实现窗口关闭时自动保存窗口状态（尺寸、位置、最大化状态）
   - 启动时自动恢复上次的窗口设置

5. **目录结构清理**
   - 安全迁移所有用户数据和备份文件到新目录结构
   - 完全删除旧的`data/`目录
   - 更新`.gitignore`文件，移除对已删除目录的引用
   - 创建`docs/DATA_STRUCTURE.md`说明新的目录结构

### 新目录结构
```
wealth_lite/
├── config/                 # 应用配置（安全，可提交到Git）
│   ├── app_config.json     # 应用配置
│   └── user_settings.json  # 用户设置
├── user_data/              # 用户数据（敏感，完全排除在Git外）
│   ├── assets.csv          # 资产数据
│   ├── transactions.csv    # 交易记录
│   ├── backups/            # 备份文件
│   └── exports/            # 导出文件
└── src/                    # 源代码
```

### 数据安全保障
- `user_data/`目录完全排除在Git版本控制之外
- 配置文件与用户数据完全分离
- 自动数据迁移确保向后兼容
- 详细的数据结构说明文档

### 技术改进
- 实现配置管理器的单例模式
- 支持嵌套配置键的设置和获取
- 窗口状态的自动保存和恢复
- 完整的测试验证流程

### 验证结果
- 所有测试通过，新目录结构工作正常
- 数据迁移功能验证成功
- 配置管理器功能完整
- 用户数据安全得到保障

### 经验总结
1. **数据安全优先**：敏感用户数据必须与代码完全分离，避免意外泄露
2. **向后兼容重要**：实现自动迁移功能，确保用户升级时数据不丢失
3. **配置分层管理**：应用配置与用户设置分离，便于维护和部署
4. **测试驱动开发**：重构前编写测试脚本，确保功能正确性

---
