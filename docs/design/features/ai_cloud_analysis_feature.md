# WealthLite 云端AI分析功能需求文档

**版本**: v1.0  
**创建日期**: 2025-07-10  
**最后更新**: 2025-07-10  
**作者**: ThalesLuo

## 1. 目标与背景

为提升投资组合快照的智能分析能力，WealthLite将集成云端AI服务，首期支持openrouter平台，后续可扩展至OpenAI、volces、本地Ollama等多种AI服务。AI将基于快照持仓明细和用户投资需求，提供专业的投资分析、建议和盈利预测，并支持多轮对话与PDF报告生成。

---

## 2. 功能需求

### 2.1 云端AI接入与模型管理

- **首期接入 openrouter**，默认模型为 `deepseek/deepseek-chat-v3-0324:free`，可选模型为 `qwen/qwen3-235b-a22b:free`。
- **模型可选**：前端支持模型切换，后端接口设计需支持多云AI（如openrouter、OpenAI、volces等），便于后续扩展。
- **AI KEY管理**：前端提供AI KEY输入界面，KEY通过安全方式传递给后端，后端负责与云端AI服务通信。

### 2.2 数据输入与分析内容

- **分析数据**：将`portfolio_snapshots`表中的`position_snapshots`（即快照持仓明细，含资产、金额、收益等）完整提供给AI进行分析。
- **Prompt设计**：默认Prompt为“你是专业的金融分析师，请对提供的投资组合进行分析”，后端可根据实际需求拼接更丰富的上下文。
- **多轮对话**：支持与AI的多轮对话，用户可补充投资需求、风险偏好等，AI基于历史对话和组合数据持续优化建议。
- **投资建议与预测**：AI需结合投资组合和用户输入的投资需求，输出投资建议和盈利预测。

### 2.3 结果输出与存档

- **分析结果展示**：前端展示AI分析结果，支持结构化（如摘要、建议、风险评估）和原文显示。
- **PDF报告生成**：支持将AI分析结果（含投资建议、盈利预测等）导出为PDF文件，便于存档和分享。

### 2.4 前端功能

- **AI KEY输入**：前端提供AI KEY输入与保存功能，支持切换/更新KEY。
- **模型选择**：前端支持选择AI模型（如deepseek、qwen等），并将选择同步到后端。
- **多轮对话界面**：前端支持与AI的多轮对话交互，历史对话可回溯。
- **分析结果与PDF导出**：前端可一键导出当前分析为PDF。

### 2.5 后端扩展性

- **多云AI接口**：后端AI分析服务需设计为可插拔，便于后续扩展OpenAI、volces、本地Ollama等AI服务。
- **本地AI支持**：后续支持本地Ollama模型加载与调用，优先级低于云端AI。
- **安全性**：AI KEY仅用于后端与AI服务通信，不在前端或日志中明文存储。

---

## 3. 非功能需求

- **安全性**：AI KEY安全传输与存储，防止泄露。
- **性能**：AI分析响应时间≤30秒，PDF导出≤5秒。
- **可用性**：AI服务异常时，前端有明确提示，支持降级为本地AI或手动分析。
- **可扩展性**：接口设计支持未来多AI平台、多模型扩展。

---

## 4. 交互流程（简要）

1. 用户在前端输入AI KEY，选择AI模型，点击“AI分析”。
2. 前端将KEY、模型、快照ID、用户需求等发送至后端。
3. 后端读取快照持仓明细，拼接Prompt，调用openrouter API获取分析结果。
4. 后端返回结构化分析结果与原文，前端展示。
5. 用户可与AI多轮对话，补充需求，AI持续优化建议。
6. 用户可一键导出当前分析为PDF报告。

---

## 5. 未来扩展

- 支持OpenAI、volces等云端AI平台。
- 支持本地Ollama模型加载与分析。
- 支持更多投资分析维度与自定义Prompt。
- 支持团队协作与分析报告分享。

---

**请确认以上需求文档，如有补充/修改请直接批注。确认后我将按此文档推进开发。** 