
# “固定收益”类“利息/分红”操作流程

### 交易记录操作流程（新增利息/分红交易）
#### 一、进入交易记录页面
- 登录系统，点击“交易记录”进入相应页面。

#### 二、新增交易
- 在交易记录页面，点击“新增交易”，打开新增交易模态窗口。

#### 三、选择现有资产
- 在新增交易模态窗口中，点击“选择资产”下拉框，从列表中选择已存在的资产。
- 选中资产后，在资产下方显示当前资产类型，如“固定收益”。
- 确保选择的资产是固定收益类资产（如人民币定期存款或外汇定期存款）。

#### 四、完善交易信息
- **选择交易类型**：选择“利息”。
- **填写利息金额**：
  - 输入利息金额（原币种），必须大于0。
- **填写交易日期**：
  - 输入利息收入的日期，默认是当日。
- **填写其他可选信息**（如果需要）：
  - **备注**：输入交易备注信息（可选）。
- **隐藏不相关信息：**
    - 币种、汇率、年利率、起息日期、到期日期

#### 五、保存交易
- 点击“保存交易”，完成新增利息/分红交易操作。

#### 六、返回交易记录页面
- 模态窗口关闭，交易记录页面自动刷新，显示新增的利息/分红交易记录。

---

### 示例说明
假设用户有一笔人民币定期存款，年中收到利息3元，年末收到利息2元。以下是具体操作流程：

1. **进入交易记录页面**：
   - 用户登录系统，点击“交易记录”进入页面。

2. **新增交易**：
   - 在交易记录页面，点击“新增交易”，打开新增交易模态窗口。

3. **选择现有资产**：
   - 在新增交易模态窗口中，点击“选择资产”下拉框，选择已存在的“人民币定期存款”资产。

4. **完善交易信息**：
   - 选择交易类型为“利息”。
   - 填写利息金额为3元。
   - 填写交易日期为年中付息日（如2024年06月30日）。
   - 输入备注信息（可选）。

5. **保存交易**：
   - 点击“保存交易”，完成新增利息交易操作。

6. **返回交易记录页面**：
   - 模态窗口关闭，交易记录页面自动刷新，显示新增的利息交易记录。

---

### 第二次利息操作
假设用户在年末收到利息2元，操作流程类似：

1. **进入交易记录页面**：
   - 用户登录系统，点击“交易记录”进入页面。

2. **新增交易**：
   - 在交易记录页面，点击“新增交易”，打开新增交易模态窗口。

3. **选择现有资产**：
   - 在新增交易模态窗口中，点击“选择资产”下拉框，选择已存在的“人民币定期存款”资产。

4. **完善交易信息**：
   - 选择交易类型为“利息”。
   - 填写利息金额为2元。
   - 填写交易日期为年末付息日（如2024年12月31日）。
   - 输入备注信息（可选）。

5. **保存交易**：
   - 点击“保存交易”，完成新增利息交易操作。

6. **返回交易记录页面**：
   - 模态窗口关闭，交易记录页面自动刷新，显示新增的利息交易记录。

---

### 参数说明
- **asset_id**：必须是已存在的固定收益类资产的唯一标识符。
- **transaction_type**：固定值为`TransactionType.INTEREST`，表示这是一笔利息收入交易。
- **amount**：利息金额，必须大于0。
- **transaction_date**：利息收入的日期，通常是付息日或到期日。
- **currency**：利息收入的币种，默认为资产的币种，不在页面显示。
- **exchange_rate**：对基础货币的汇率，默认为1.0，不在页面显示。
- **notes**：交易备注信息（可选）。

这种操作流程能够清晰地记录每次利息/分红交易，并确保所有相关信息都被正确记录和保存。

---

## 实现状态

### ✅ 已完成的功能

1. **字段显示控制**
   - ✅ 利息交易时完全隐藏固定收益相关字段（年利率、起息日期、到期日期等）
   - ✅ 利息交易时隐藏币种和汇率字段
   - ✅ 实现极简化的利息交易界面

2. **数据自动获取**
   - ✅ 利息交易时自动从资产信息获取币种
   - ✅ 利息交易时自动获取对应的汇率
   - ✅ 无需用户手动输入币种和汇率

3. **验证逻辑简化**
   - ✅ 利息交易使用简化验证，只验证基本字段（资产、金额、日期）
   - ✅ 移除对固定收益字段的验证要求
   - ✅ 利息交易时不设置固定收益字段为必填

4. **用户体验优化**
   - ✅ 利息交易界面极简化，只显示必要字段
   - ✅ 自动填充技术参数，减少用户操作
   - ✅ 符合workflow设计的操作流程

### 🔧 技术实现细节

1. **前端UI控制**
   - `adjustFieldsForTransactionType()` - 根据交易类型控制字段显示
   - `hideAllFixedIncomeFields()` - 隐藏所有固定收益字段
   - `hideCurrencyAndExchangeRateFields()` - 隐藏币种和汇率字段

2. **数据处理逻辑**
   - `handleInterestTransaction()` - 利息交易专用处理逻辑
   - `getAssetInfo()` - 自动获取资产信息
   - `getExchangeRate()` - 自动获取汇率

3. **验证逻辑**
   - `validateFixedIncomeTransaction()` - 根据交易类型使用不同验证规则
   - `setFixedIncomeFieldsRequired()` - 动态设置必填字段

### 📝 使用说明

利息交易现在完全符合workflow设计：
1. 选择固定收益资产
2. 选择"利息"交易类型
3. 输入利息金额
4. 选择交易日期
5. 可选填写备注
6. 保存交易

系统会自动：
- 从资产信息获取币种
- 根据币种获取汇率
- 隐藏不相关的复杂字段
- 使用简化的验证逻辑

*最后更新时间：2025-01-06*