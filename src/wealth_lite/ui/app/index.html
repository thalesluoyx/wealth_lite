<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WealthLite - 个人财富管理系统</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/dashboard.css">
    <link rel="stylesheet" href="styles/transactions.css">
    <link rel="stylesheet" href="styles/components/assets.css">
    <link rel="stylesheet" href="styles/portfolio.css">
    <!-- Chart.js 轻量图表库 -->
    <script src="js/chart.umd.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Stagewise Toolbar Integration (Development Only) -->
    <script>
        // 检测是否为开发环境（本地服务器）
        const isDevelopment = window.location.hostname === 'localhost' || 
                             window.location.hostname === '127.0.0.1' ||
                             window.location.hostname === '';
        
        if (isDevelopment) {
            // 动态加载 stagewise 工具栏
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/@stagewise/toolbar@latest/dist/toolbar.min.js';
            script.onload = function() {
                if (window.stagewise) {
                    window.stagewise.initToolbar({
                        plugins: [],
                        enabled: true
                    });
                }
            };
            document.head.appendChild(script);
        }
    </script>
</head>
<body>
    <!-- 主容器 -->
    <div class="app-container">
        <!-- 顶部导航栏 -->
        <header class="navbar">
            <div class="nav-left">
                <div class="logo">
                    <i data-lucide="wallet"></i>
                    <span>WealthLite</span>
                </div>
                <nav class="nav-menu">
                    <a href="#dashboard" class="nav-item active">
                        <i data-lucide="home"></i>
                        <span>仪表板</span>
                    </a>
                    <a href="#transactions" class="nav-item">
                        <i data-lucide="receipt"></i>
                        <span>交易记录</span>
                    </a>
                    <a href="#assets" class="nav-item">
                        <i data-lucide="coins"></i>
                        <span>资产管理</span>
                    </a>
                    <a href="#portfolio" class="nav-item">
                        <i data-lucide="pie-chart"></i>
                        <span>投资组合</span>
                    </a>
                </nav>
            </div>
            <div class="nav-right">
                <button class="btn-icon" title="搜索">
                    <i data-lucide="search"></i>
                </button>
                <button class="btn-icon" title="通知">
                    <i data-lucide="bell"></i>
                </button>
                <button class="btn-icon" title="设置">
                    <i data-lucide="settings"></i>
                </button>
                <div class="currency-toggle">
                    <button id="currencyToggle" class="btn-currency">CNY</button>
                </div>
            </div>
        </header>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 仪表板页面 -->
            <div id="dashboard" class="page active">
                <!-- 主图表区域 -->
                <section class="chart-section">
                    <div class="chart-header">
                        <h2>资产总览</h2>
                        <div class="time-range">
                            <button class="time-btn active" data-range="7d">7天</button>
                            <button class="time-btn" data-range="1m">1月</button>
                            <button class="time-btn" data-range="3m">3月</button>
                            <button class="time-btn" data-range="1y">1年</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="mainChart"></canvas>
                        <!-- 数据悬浮卡片 -->
                        <div class="chart-tooltip" id="chartTooltip">
                            <div class="tooltip-date">4月</div>
                            <div class="tooltip-values">
                                <div class="tooltip-item">
                                    <span class="label">现金</span>
                                    <span class="value">8,435,530元</span>
                                </div>
                                <div class="tooltip-item">
                                    <span class="label">存款</span>
                                    <span class="value">6,234,560元</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 持仓明细列表 -->
                <section class="positions-section">
                    <div class="positions-list-card">
                        <div class="card-header">
                            <h3>持仓明细</h3>
                            <div class="card-stats">
                                <span class="badge" id="positionCount">共 0 笔持仓</span>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="positions-table">
                                <thead>
                                    <tr>
                                        <th>资产名称</th>
                                        <th>类型</th>
                                        <th>当前价值</th>
                                        <th>总收益</th>
                                        <th>收益率</th>
                                        <th>状态</th>
                                        <th>持有天数</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="positionsTableBody">
                                    <!-- 持仓记录将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                            <div class="table-empty" id="positionsEmpty" style="display: none;">
                                <div class="empty-icon">
                                    <i data-lucide="wallet"></i>
                                </div>
                                <div class="empty-text">暂无持仓</div>
                                <div class="empty-subtext">开始记录您的第一笔交易来建立持仓</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 统计卡片区域 -->
                <section class="stats-section">
                    <!-- 资产类型圆环图卡片 -->
                    <div class="chart-card">
                        <h3>资产类型分布</h3>
                        <div class="donut-chart-container">
                            <canvas id="assetTypeChart"></canvas>
                            <div class="chart-center">
                                <div class="center-amount" id="assetTypeAmount">0</div>
                                <div class="center-label">元</div>
                            </div>
                        </div>
                    </div>

                    <!-- 现金及等价物饼图卡片 -->
                    <div class="chart-card">
                        <h3>现金类资产</h3>
                        <div class="pie-chart-container">
                            <canvas id="cashChart"></canvas>
                            <div class="chart-center">
                                <div class="center-amount" id="cashAmount">0</div>
                                <div class="center-label">元</div>
                            </div>
                        </div>
                    </div>

                    <!-- 固定收益饼图卡片 -->
                    <div class="chart-card">
                        <h3>固定收益</h3>
                        <div class="pie-chart-container">
                            <canvas id="fixedIncomeChart"></canvas>
                            <div class="chart-center">
                                <div class="center-amount" id="fixedAmount">0</div>
                                <div class="center-label">元</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- 其他页面占位 -->
            <!-- 资产管理页面 -->
            <div id="assets" class="page">
                <div class="page-header">
                    <h2>💰 资产管理</h2>
                    <div class="page-actions">
                        <button class="btn-primary" id="addAssetBtn">
                            <i data-lucide="plus"></i>
                            新增资产
                        </button>
                    </div>
                </div>

                <!-- 资产列表 -->
                <section class="assets-section">
                    <div class="assets-card">
                        <div class="card-header">
                            <h3>资产列表</h3>
                            <div class="card-stats">
                                <span class="badge" id="assetCount">共 0 个资产</span>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="assets-table">
                                <thead>
                                    <tr>
                                        <th>资产名称</th>
                                        <th>资产类型</th>
                                        <th>子类型</th>
                                        <th>币种</th>
                                        <th>创建时间</th>
                                        <th>描述</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="assetsTableBody">
                                    <!-- 资产记录将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                            <div class="table-empty" id="assetsEmpty" style="display: none;">
                                <div class="empty-icon">
                                    <i data-lucide="coins"></i>
                                </div>
                                <div class="empty-text">暂无资产</div>
                                <div class="empty-subtext">点击"新增资产"按钮开始添加您的第一个资产</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- 交易记录页面 -->
            <div id="transactions" class="page">
                <div class="page-header">
                    <h2>📋 交易记录</h2>
                    <div class="page-actions">
                        <button class="btn-primary" id="addTransactionBtn">
                            <i data-lucide="plus"></i>
                            新增交易
                        </button>
                    </div>
                </div>

                <!-- 交易统计卡片 -->
                <section class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i data-lucide="hash"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">本月交易笔数</div>
                            <div class="stat-value" id="monthlyTransactionCount">156</div>
                            <div class="stat-change positive">+23</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i data-lucide="trending-up"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">本月交易金额</div>
                            <div class="stat-value" id="monthlyTransactionAmount">1,234,567</div>
                            <div class="stat-change positive">+15.6%</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i data-lucide="dollar-sign"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">本月收益</div>
                            <div class="stat-value" id="monthlyReturn">23,456</div>
                            <div class="stat-change positive">+12.3%</div>
                        </div>
                    </div>
                </section>

                <!-- 工具栏 -->
                <section class="toolbar-section">
                    <div class="toolbar-card">
                        <div class="toolbar-left">
                            <div class="search-box">
                                
                                <input type="text" placeholder="搜索交易记录..." id="transactionSearch">
                            </div>
                            <div class="filter-group">
                                <select id="transactionTypeFilter" class="filter-select">
                                    <option value="">所有类型</option>
                                    <option value="DEPOSIT">存入</option>
                                    <option value="WITHDRAW">提取</option>
                                    <option value="INTEREST">利息</option>
                                </select>
                                <select id="assetFilter" class="filter-select">
                                    <option value="">所有资产</option>
                                </select>
                                <div class="date-range">
                                    <input type="date" id="startDate" class="date-input">
                                    <span class="date-separator">至</span>
                                    <input type="date" id="endDate" class="date-input">
                                </div>
                            </div>
                        </div>
                        <div class="toolbar-right">
                            <button class="btn-secondary" id="exportBtn">
                                <i data-lucide="download"></i>
                                导出
                            </button>
                        </div>
                    </div>
                </section>

                <!-- 交易列表 -->
                <section class="transactions-section">
                    <div class="transactions-card">
                        <div class="card-header">
                            <h3>交易记录</h3>
                            <div class="card-stats">
                                <span class="badge" id="transactionCount">共 0 笔交易</span>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="transactions-table">
                                <thead>
                                    <tr>
                                        <th data-sort="date">日期 <i data-lucide="chevron-down"></i></th>
                                        <th data-sort="asset">资产</th>
                                        <th data-sort="type">交易类型</th>
                                        <th data-sort="amount">金额</th>
                                        <th data-sort="currency">币种</th>
                                        <th>备注</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody">
                                    <!-- 交易记录将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                            <div class="table-empty" id="transactionsEmpty" style="display: none;">
                                <div class="empty-icon">
                                    <i data-lucide="file-x"></i>
                                </div>
                                <div class="empty-text">暂无交易记录</div>
                                <div class="empty-subtext">点击"新增交易"按钮开始记录您的第一笔交易</div>
                            </div>
                        </div>
                        <div class="table-pagination" id="transactionsPagination">
                            <div class="pagination-info">
                                显示 <span id="paginationStart">1</span> - <span id="paginationEnd">10</span> 
                                共 <span id="paginationTotal">0</span> 条记录
                            </div>
                            <div class="pagination-controls">
                                <button class="btn-pagination" id="prevPage" disabled>
                                    <i data-lucide="chevron-left"></i>
                                </button>
                                <button class="btn-pagination" id="nextPage" disabled>
                                    <i data-lucide="chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div id="portfolio" class="page">
                <div class="page-header">
                    <h2>📊 投资组合</h2>
                    <div class="page-actions">
                        <button class="btn-primary" id="createSnapshotBtn">
                            <i data-lucide="camera"></i>
                            创建快照
                        </button>
                    </div>
                </div>

                <!-- 当前组合概览 -->
                <section class="portfolio-overview">
                    <div class="overview-card">
                        <h3>🔄 当前组合概览</h3>
                        <div class="overview-stats">
                            <div class="stat-item">
                                <div class="stat-label">总价值</div>
                                <div class="stat-value" id="portfolioTotalValue">¥0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">总收益</div>
                                <div class="stat-value" id="portfolioTotalReturn">¥0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">收益率</div>
                                <div class="stat-value" id="portfolioReturnRate">0%</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 快照浏览 -->
                <section class="snapshots-section">
                    <div class="snapshots-card">
                        <div class="card-header">
                            <h3>📈 快照浏览</h3>
                            <div class="snapshot-tabs">
                                <button class="tab-btn active" id="autoSnapshotsTab" data-type="auto">
                                    <i data-lucide="zap"></i>
                                    自动快照
                                </button>
                                <button class="tab-btn" id="manualSnapshotsTab" data-type="manual">
                                    <i data-lucide="user"></i>
                                    手动快照
                                </button>
                            </div>
                        </div>
                        <div id="snapshotStats" class="snapshot-stats" style="margin: 8px 0 0 0;"></div>
                        <div class="snapshots-content">
                            <!-- 快照列表 -->
                            <div class="snapshots-list" id="snapshotsList">
                                <div class="table-container">
                                    <table class="snapshots-table">
                                        <thead>
                                            <tr>
                                                <th>日期</th>
                                                <th>类型</th>
                                                <th>总价值</th>
                                                <th>收益率</th>
                                                <th>备注</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="snapshotsTableBody">
                                            <!-- 快照记录将通过JavaScript动态填充 -->
                                        </tbody>
                                    </table>
                                    <div class="table-empty" id="snapshotsEmpty" style="display: none;">
                                        <div class="empty-icon">
                                            <i data-lucide="camera-off"></i>
                                        </div>
                                        <div class="empty-text">暂无快照</div>
                                        <div class="empty-subtext">点击"创建快照"按钮保存当前投资组合状态</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 快照对比分析 -->
                <section class="comparison-section">
                    <div class="comparison-card">
                        <div class="card-header">
                            <h3>🔍 快照对比分析</h3>
                            <div class="comparison-controls">
                                <button class="btn-secondary" id="clearComparisonBtn" style="display: none;">
                                    <i data-lucide="x"></i>
                                    清除选择
                                </button>
                            </div>
                        </div>
                        <div class="comparison-content">
                            <!-- 快照选择区域 -->
                            <div class="snapshot-selection">
                                <div class="selection-item">
                                    <label>快照1：</label>
                                    <div class="selected-snapshot" id="selectedSnapshot1">
                                        <div class="placeholder">点击快照列表中的快照进行选择</div>
                                    </div>
                                </div>
                                <div class="selection-item">
                                    <label>快照2：</label>
                                    <div class="selected-snapshot" id="selectedSnapshot2">
                                        <div class="placeholder">选择第二个快照进行对比</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 对比操作按钮 -->
                            <div class="comparison-actions">
                                <button class="btn-primary" id="compareSnapshotsBtn" disabled>
                                    <i data-lucide="git-compare"></i>
                                    对比分析
                                </button>
                            </div>

                            <!-- 对比结果显示区域 -->
                            <div class="comparison-results" id="comparisonResults" style="display: none;">
                                <!-- 基础对比数据 -->
                                <div class="comparison-overview">
                                    <div class="comparison-stat">
                                        <div class="stat-label">价值变化</div>
                                        <div class="stat-value" id="valueChange">--</div>
                                    </div>
                                    <div class="comparison-stat">
                                        <div class="stat-label">变化幅度</div>
                                        <div class="stat-value" id="changeRate">--</div>
                                    </div>
                                    <div class="comparison-stat">
                                        <div class="stat-label">时间间隔</div>
                                        <div class="stat-value" id="timePeriod">--</div>
                                    </div>
                                </div>

                                <!-- 详细对比数据 -->
                                <div class="comparison-details" id="comparisonDetails">
                                    <!-- 对比数据将通过JavaScript动态填充 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- AI分析对比 -->
                <section class="ai-analysis-section">
                    <div class="ai-analysis-card">
                        <div class="card-header">
                            <h3>🤖 AI分析对比</h3>
                            <div class="ai-config-display">
                                <span class="ai-type-label">当前AI：</span>
                                <span class="ai-type-value" id="currentAiType">本地AI</span>
                                <button class="btn-link" id="changeAiTypeBtn">
                                    <i data-lucide="settings"></i>
                                    切换
                                </button>
                            </div>
                        </div>
                        <div class="ai-analysis-content">
                            <!-- AI分析操作 -->
                            <div class="ai-analysis-actions">
                                <button class="btn-primary" id="aiAnalyzeBtn" disabled>
                                    <i data-lucide="brain"></i>
                                    AI分析
                                </button>
                                <div class="ai-status" id="aiStatus" style="display: none;">
                                    <div class="loading-spinner"></div>
                                    <span>AI分析中...</span>
                                </div>
                            </div>

                            <!-- AI分析结果 -->
                            <div class="ai-analysis-results" id="aiAnalysisResults" style="display: none;">
                                <div class="analysis-summary">
                                    <h4>分析摘要</h4>
                                    <div class="summary-content" id="analysisSummary">--</div>
                                </div>
                                <div class="analysis-advice">
                                    <h4>投资建议</h4>
                                    <div class="advice-content" id="investmentAdvice">--</div>
                                </div>
                                <div class="analysis-risk">
                                    <h4>风险评估</h4>
                                    <div class="risk-content" id="riskAssessment">--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- 新增交易模态窗口 -->
    <div id="addTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>新增交易</h3>
                <button class="modal-close" id="closeTransactionModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <form id="addTransactionForm" class="modal-body">
                <!-- 资产选择器 -->
                <div class="form-group">
                    <label for="assetSelect" class="form-label">选择资产 *</label>
                    <div class="asset-selector">
                        <select id="assetSelect" class="form-select" required>
                            <option value="">请选择资产...</option>
                        </select>
                        <button type="button" class="btn-link" id="createAssetBtn">
                            <i data-lucide="plus"></i>
                            创建新资产
                        </button>
                    </div>
                    <!-- 资产类型显示 -->
                    <div class="asset-type-display" id="assetTypeDisplay" style="display: none;">
                        <span class="asset-type-label">资产类型：</span>
                        <span class="asset-type-value" id="assetTypeValue">-</span>
                    </div>
                </div>

                <!-- 交易类型 -->
                <div class="form-group">
                    <label for="transactionType" class="form-label">交易类型 *</label>
                    <select id="transactionType" class="form-select" required>
                        <option value="">请选择交易类型...</option>
                        <option value="DEPOSIT">存入</option>
                        <option value="WITHDRAW">提取</option>
                        <option value="INTEREST">利息</option>
                    </select>
                </div>

                <!-- 交易金额 -->
                <div class="form-group">
                    <label for="transactionAmount" class="form-label">交易金额 *</label>
                    <input type="number" id="transactionAmount" class="form-input" 
                           step="0.01" min="0" placeholder="0.00" required>
                </div>

                <!-- 币种 (由资产决定，不可修改) -->
                <div class="form-group">
                    <label for="transactionCurrency" class="form-label">币种 *</label>
                    <input type="text" id="transactionCurrency" class="form-input" 
                           placeholder="请先选择资产..." readonly disabled 
                           style="background: #f8fafc; color: #64748b;">
                    <div class="form-help">
                        币种由所选资产的计价币种自动确定，不可修改
                    </div>
                </div>

                <!-- 汇率 (非基础货币时显示) -->
                <div class="form-group" id="exchangeRateGroup" style="display: none;">
                    <label for="exchangeRate" class="form-label">汇率 (1 外币 = ? CNY)</label>
                    <input type="number" id="exchangeRate" class="form-input" 
                           step="0.0001" min="0" placeholder="0.0000">
                    <div class="form-help">
                        请输入交易时的实际汇率，如不填写将使用系统默认汇率
                    </div>
                </div>

                <!-- 汇率信息预览区域会通过JavaScript动态插入到这里 -->

                <!-- 交易日期 -->
                <div class="form-group">
                    <label for="transactionDate" class="form-label">交易日期 *</label>
                    <input type="date" id="transactionDate" name="transaction_date" class="form-input" required>
                </div>

                <!-- 备注 -->
                <div class="form-group">
                    <label for="transactionNotes" class="form-label">备注</label>
                    <textarea id="transactionNotes" class="form-textarea" 
                              placeholder="交易备注信息..." rows="3"></textarea>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelTransactionBtn">取消</button>
                <button type="submit" class="btn-primary" form="addTransactionForm">保存交易</button>
            </div>
        </div>
    </div>

    <!-- 资产管理模态窗口 -->
    <div id="assetManagementModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 id="assetModalTitle">新增资产</h3>
                <button class="modal-close" id="closeAssetManagementModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <form id="assetManagementForm" class="modal-body">
                <!-- 资产名称 -->
                <div class="form-group">
                    <label for="assetManagementName" class="form-label">资产名称 *</label>
                    <input type="text" id="assetManagementName" class="form-input" 
                           placeholder="例如：招商银行储蓄账户" required>
                </div>

                <!-- 资产类型 -->
                <div class="form-group">
                    <label for="assetManagementType" class="form-label">资产类型 *</label>
                    <select id="assetManagementType" class="form-select" required>
                        <option value="">请选择资产类型...</option>
                        <option value="CASH">现金及等价物</option>
                        <option value="FIXED_INCOME">固定收益类</option>
                        <option value="EQUITY">权益类</option>
                    </select>
                </div>

                <!-- 资产子类型 -->
                <div class="form-group" id="assetSubTypeGroup" style="display: none;">
                    <label for="assetManagementSubType" class="form-label">资产子类型 *</label>
                    <select id="assetManagementSubType" class="form-select">
                        <option value="">请选择资产子类型...</option>
                    </select>
                </div>

                <!-- 币种 -->
                <div class="form-group">
                    <label for="assetManagementCurrency" class="form-label">币种 *</label>
                    <select id="assetManagementCurrency" class="form-select" required>
                        <option value="CNY">CNY - 人民币</option>
                        <option value="USD">USD - 美元</option>
                        <option value="HKD">HKD - 港币</option>
                        <option value="EUR">EUR - 欧元</option>
                    </select>
                </div>

                <!-- 描述 -->
                <div class="form-group">
                    <label for="assetManagementDescription" class="form-label">描述</label>
                    <textarea id="assetManagementDescription" class="form-textarea" 
                              placeholder="资产描述信息..." rows="2"></textarea>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelAssetManagementBtn">取消</button>
                <button type="submit" class="btn-primary" form="assetManagementForm" id="saveAssetBtn">保存资产</button>
            </div>
        </div>
    </div>

    <!-- 创建快照模态窗口 -->
    <div id="createSnapshotModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>创建投资组合快照</h3>
                <button class="modal-close" id="closeSnapshotModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <form id="createSnapshotForm" class="modal-body">
                <!-- 快照类型显示 -->
                <div class="form-group">
                    <label class="form-label">快照类型</label>
                    <div class="snapshot-type-display">
                        <span class="type-badge manual">
                            <i data-lucide="user"></i>
                            手动快照
                        </span>
                        <div class="type-description">用户主动创建的快照，可添加备注信息</div>
                    </div>
                </div>

                <!-- 快照预览 -->
                <div class="form-group">
                    <label class="form-label">当前投资组合状态</label>
                    <div class="snapshot-preview">
                        <div class="preview-stat">
                            <span class="label">总价值：</span>
                            <span class="value" id="previewTotalValue">¥0</span>
                        </div>
                        <div class="preview-stat">
                            <span class="label">总收益：</span>
                            <span class="value" id="previewTotalReturn">¥0</span>
                        </div>
                        <div class="preview-stat">
                            <span class="label">收益率：</span>
                            <span class="value" id="previewReturnRate">0%</span>
                        </div>
                    </div>
                </div>

                <!-- 备注 -->
                <div class="form-group">
                    <label for="snapshotNotes" class="form-label">备注</label>
                    <textarea id="snapshotNotes" class="form-textarea" 
                              placeholder="记录快照创建的原因或重要事件..." rows="3"></textarea>
                    <div class="form-help">可选：记录创建此快照的背景信息</div>
                </div>

                <!-- 覆盖警告 -->
                <div class="warning-message" id="snapshotWarning" style="display: none;">
                    <i data-lucide="alert-triangle"></i>
                    <div class="warning-content">
                        <div class="warning-title">今日已存在手动快照</div>
                        <div class="warning-text">创建新快照将覆盖今日的现有快照，是否继续？</div>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelSnapshotBtn">取消</button>
                <button type="submit" class="btn-primary" form="createSnapshotForm">创建快照</button>
            </div>
        </div>
    </div>

    <!-- AI配置模态窗口 -->
    <div id="aiConfigModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>AI分析配置</h3>
                <button class="modal-close" id="closeAiConfigModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- AI类型选择 -->
                <div class="form-group">
                    <label class="form-label">AI服务类型</label>
                    <div class="ai-type-options">
                        <div class="ai-option" data-type="LOCAL">
                            <div class="option-header">
                                <input type="radio" id="aiTypeLocal" name="aiType" value="LOCAL" checked>
                                <label for="aiTypeLocal">
                                    <i data-lucide="home"></i>
                                    本地AI
                                </label>
                            </div>
                            <div class="option-description">使用本地部署的AI模型（Ollama）</div>
                            <div class="option-details">
                                <div class="detail-item">
                                    <span>✓ 数据隐私保护</span>
                                </div>
                                <div class="detail-item">
                                    <span>✓ 无网络依赖</span>
                                </div>
                                <div class="detail-item">
                                    <span>⚠ 需要本地环境支持</span>
                                </div>
                            </div>
                        </div>
                        <div class="ai-option" data-type="CLOUD">
                            <div class="option-header">
                                <input type="radio" id="aiTypeCloud" name="aiType" value="CLOUD">
                                <label for="aiTypeCloud">
                                    <i data-lucide="cloud"></i>
                                    云端AI
                                </label>
                            </div>
                            <div class="option-description">使用云端AI服务（OpenAI、Claude等）</div>
                            <div class="option-details">
                                <div class="detail-item">
                                    <span>✓ 高质量分析</span>
                                </div>
                                <div class="detail-item">
                                    <span>✓ 免部署即用</span>
                                </div>
                                <div class="detail-item">
                                    <span>⚠ 需要API密钥</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 本地AI配置 -->
                <div class="ai-config-section" id="localAiConfig">
                    <h4>本地AI配置</h4>
                    <div class="form-group">
                        <label for="localModelName" class="form-label">模型名称</label>
                        <input type="text" id="localModelName" class="form-input" 
                               value="llama3.1:8b" placeholder="llama3.1:8b">
                        <div class="form-help">Ollama模型名称，确保已在本地安装</div>
                    </div>
                    <div class="form-group">
                        <label for="localApiPort" class="form-label">API端口</label>
                        <input type="number" id="localApiPort" class="form-input" 
                               value="11434" placeholder="11434">
                        <div class="form-help">Ollama API服务端口</div>
                    </div>
                    <div class="ai-status" id="localAiStatus">
                        <div class="status-indicator unknown"></div>
                        <span>连接状态未知</span>
                        <button type="button" class="btn-link" id="testLocalConnection">测试连接</button>
                    </div>
                </div>

                <!-- 云端AI配置 -->
                <div class="ai-config-section" id="cloudAiConfig" style="display: none;">
                    <h4>云端AI配置</h4>
                    <div class="form-group">
                        <label for="cloudProvider" class="form-label">服务提供商</label>
                        <select id="cloudProvider" class="form-select">
                            <option value="OPENAI">OpenAI (GPT)</option>
                            <option value="CLAUDE">Anthropic (Claude)</option>
                            <option value="GEMINI">Google (Gemini)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cloudApiKey" class="form-label">API密钥</label>
                        <input type="password" id="cloudApiKey" class="form-input" 
                               placeholder="输入您的API密钥...">
                        <div class="form-help">API密钥将被安全存储，仅用于AI分析</div>
                    </div>
                    <div class="form-group">
                        <label for="cloudModelName" class="form-label">模型名称</label>
                        <input type="text" id="cloudModelName" class="form-input" 
                               placeholder="gpt-4o-mini">
                        <div class="form-help">使用的具体模型名称</div>
                    </div>
                    <div class="ai-status" id="cloudAiStatus">
                        <div class="status-indicator unknown"></div>
                        <span>连接状态未知</span>
                        <button type="button" class="btn-link" id="testCloudConnection">测试连接</button>
                    </div>
                </div>

                <!-- 通用配置 -->
                <div class="ai-config-section">
                    <h4>分析参数</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="aiTemperature" class="form-label">创造性 (Temperature)</label>
                            <input type="range" id="aiTemperature" class="form-range" 
                                   min="0" max="1" step="0.1" value="0.7">
                            <div class="range-value" id="temperatureValue">0.7</div>
                            <div class="form-help">较低值产生更保守的分析，较高值更有创造性</div>
                        </div>
                        <div class="form-group">
                            <label for="aiMaxTokens" class="form-label">最大输出长度</label>
                            <input type="number" id="aiMaxTokens" class="form-input" 
                                   value="4000" min="1000" max="8000">
                            <div class="form-help">控制AI分析报告的详细程度</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelAiConfigBtn">取消</button>
                <button type="button" class="btn-primary" id="saveAiConfigBtn">保存配置</button>
            </div>
        </div>
    </div>

    <!-- 快照详情模态窗口 -->
    <div id="snapshotDetailModal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="snapshotDetailTitle">快照详情</h3>
                <button class="modal-close" id="closeSnapshotDetailModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- 快照基本信息 -->
                <div class="snapshot-detail-overview">
                    <div class="detail-stats">
                        <div class="detail-stat">
                            <div class="stat-label">总价值</div>
                            <div class="stat-value" id="detailTotalValue">¥0</div>
                        </div>
                        <div class="detail-stat">
                            <div class="stat-label">总成本</div>
                            <div class="stat-value" id="detailTotalCost">¥0</div>
                        </div>
                        <div class="detail-stat">
                            <div class="stat-label">总收益</div>
                            <div class="stat-value" id="detailTotalReturn">¥0</div>
                        </div>
                        <div class="detail-stat">
                            <div class="stat-label">收益率</div>
                            <div class="stat-value" id="detailReturnRate">0%</div>
                        </div>
                    </div>
                </div>

                <!-- 资产配置图表 -->
                <div class="snapshot-detail-allocation">
                    <h4>资产配置</h4>
                    <div class="allocation-chart">
                        <canvas id="snapshotAllocationChart"></canvas>
                    </div>
                </div>

                <!-- 持仓详情 -->
                <div class="snapshot-detail-positions">
                    <h4>持仓详情</h4>
                    <div class="table-container">
                        <table class="positions-table">
                            <thead>
                                <tr>
                                    <th>资产名称</th>
                                    <th>资产类型</th>
                                    <th>当时价值</th>
                                    <th>占比</th>
                                </tr>
                            </thead>
                            <tbody id="snapshotPositionsBody">
                                <!-- 持仓数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="closeSnapshotDetailBtn">关闭</button>
            </div>
        </div>
    </div>



    <!-- JavaScript -->
    <!-- 固定收益产品模块 (需要在transactions.js之前加载) -->
    <script src="js/components/fixed-income-manager.js"></script>
    
    <script src="js/transactions.js"></script>
    <script src="js/assets.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/portfolio.js"></script>
    <script src="js/main.js"></script>
    
    <!-- 开发工具 (仅在开发环境加载) -->
    <script>
        // 检测是否为开发环境并加载开发工具
        (function() {
            const isDevEnv = window.location.hostname === 'localhost' || 
                            window.location.hostname === '127.0.0.1' ||
                            window.location.hostname === '';
            
            if (isDevEnv) {
                // 动态加载 Stagewise 开发工具
                const script = document.createElement('script');
                script.src = 'dev-tools/stagewise-toolbar.js';
                script.onload = () => {
                    console.log('🎯 Stagewise 开发工具已加载');
                };
                script.onerror = () => {
                    console.log('⚠️ Stagewise 开发工具未找到，跳过加载');
                };
                document.head.appendChild(script);
            }
        })();
    </script>
</body>
</html> 